[[PageOutline]]

= GHC Repositories =

This page lists the active repositories relating to GHC. For instructions on actually getting a GHC source tree, see [wiki:Building/GettingTheSources Getting The Sources].

For read-only browsing, you can use the:
 * [http://hackage.haskell.org/trac/ghc/browser Trac source browser]
 * [http://github.com/ghc/ghc GitHub GHC mirror]
 * [http://darcs.haskell.org/cgi-bin/gitweb.cgi GitWeb GHC browser]

GHC's repos use git; see [wiki:WorkingConventions/Git Git Working Conventions]. For darcs-related stuff see [wiki:DarcsToGit Darcs To Git] and [wiki:GitForDarcsUsers Git For Darcs Users].

== Overview ==

A GHC source tree is made of a collection of repositories. The script [wiki:Building/SyncAll sync-all] knows how to apply git commands to the whole collection of repositories at once, for example to pull changes from the upstream repositories.

The root of the source tree is the GHC repository itself, the other repositories live in various subdirectories. The master list of repositories is in the file [[GhcFile(packages)]], and this is where the `sync-all` script finds out about which repositories make up the complete tree.

The "`tag`" in the master table in packages has the following significance:

 * '''"`-`"''': [wiki:Commentary/Libraries boot libraries], necessary to build GHC
 * '''"`testsuite`"''': GHC's [wiki:Building/RunningTests regression tests], not necessary for a build, but is necessary if you're working on GHC
 * '''"`nofib`"''': GHC's [wiki:Building/RunningNoFib nofib benchmark suite]
 * '''"`dph`"''': packages for [wiki:DataParallel Data Parallel Haskell], which is not shipped with GHC but we test all changes to GHC against these repositories so they are usually included in a checked-out source tree.
 * '''"`extra`"''': extra packages you might want to include in a build (the `parallel` package, for example), but aren't necessary to get a working GHC.

== Repository and mirrors ==

Many of the libraries and tools in a GHC tree are actually maintained by someone else. They therefore have a separate upstream repository, from which we need to pull. That repository may be either a darcs or a git repository; in the darcs case, we also need to convert to a git repository for use in a GHC tree. However, if the darcs repository is on another server, then we first need to mirror it for the conversion program to use. This diagram shows how changes migrate from one repo to another:

[[Image(repos.png)]]

This means that when making changes needed in GHC to one of these libraries, we first need to put the changes in the upstream repository. Note that a git hook prevents you from pushing patches to the ghc repos until they are already in the git mirror repos, so that we cannot forget to send changes upstream.

The mirrors are updated automatically each night, but you can force an immediate update by running `/srv/darcs/do_mirrors` on `darcs.haskell.org`.

== When the master repo is in Git ==

If the master (upstream) repo is in Git (eg `containers`), you can use the following workflow:
 1. Push the change to the upstream repo `//github.com/haskell/containers.git`
 2. Push the change to the validated GHC repo for `containers`, namely `darcs.haskell.org:/srv/darcs/packages/containers.git`.

In other words, you don't need to interact with the git mirror on `darcs.haskell.org`. It is ''only'' there so that in step (2), the push script can check that the patch you are pushing is in the mirror, thereby ensuring that we always lag the master repo.  (For some reason this is hard to do directly on the master.)

Note step 2 will fail until the mirror has been updated.

== When the master repo is in Darcs ==

Things are a bit more complicated when the master repo is in Darcs.  For example, to make a change to bytestring:

 1. First push the change as a darcs patch to the upstream bytestring repository, http://darcs.haskell.org/bytestring/
 2. The patch will be mirrored and converted to git by the mirror script, in the repo http://darcs.haskell.org/git-mirrors/bytestring/.git/
 3. You then need to pull from http://darcs.haskell.org/git-mirrors/bytestring/.git/ into `libraries/bytestring` in a regular GHC tree, validate, and push to the GHC bytestring repo, `darcs.haskell.org:/srv/darcs/packages/bytestring.git`.

== Repository locations ==
{{{
#!html

<p>This table shows, for each repository in a GHC tree, where the <span style="color: green;">central repository</span> (identified in green) is, and what mirrors there are.</p>
<p>For the common case where the central repository held on <tt>darcs.haskell.org</tt> and appears in the "ghc (validated) repo" column, we give the read-only URL.  To get a read/write URL, replace HTTP prefix <tt>http://darcs.haskell.org</tt> with the SSH prefix <tt>darcs.haskell.org:/srv/darcs</tt>.

<table border="2">
<tr><td colspan="2">darcs</td><td colspan="4">git</td><td></td></tr>
<tr><td>darcs upstream</td><td>darcs mirror</td><td>git upstream</td><td>git mirror</td><td>ghc (validated) repo</td><td>in-tree</td><td></td></tr>
<tr><td></td><td></td><td></td><td></td><td style="color: green;">http://darcs.haskell.org/ghc.git/</td><td>.</td><td rowspan="33">ghc</td></tr>
<tr><td></td><td></td><td></td><td></td><td style="color: green;">http://darcs.haskell.org/ghc-tarballs.git/</td><td>ghc-tarballs</td></tr>
<tr><td></td><td></td><td></td><td></td><td style="color: green;">http://darcs.haskell.org/utils/hsc2hs.git/</td><td>utils/hsc2hs</td></tr>
<tr><td></td><td></td><td></td><td></td><td style="color: green;">http://darcs.haskell.org/haddock.git</td><td>utils/haddock</td></tr>
<tr><td></td><td></td><td></td><td></td><td style="color: green;">http://darcs.haskell.org/packages/array.git/</td><td>libraries/array</td></tr>
<tr><td></td><td></td><td></td><td></td><td style="color: green;">http://darcs.haskell.org/packages/base.git/</td><td>libraries/base</td></tr>
<tr><td></td><td></td><td style="color: green;">git://github.com/kolmodin/binary.git</td><td>http://darcs.haskell.org/git-mirrors/binary/binary.git/</td><td>http://darcs.haskell.org/packages/.git/</td><td>libraries/binary</td></tr>
<tr><td style="color: green;">http://darcs.haskell.org/bytestring/</td><td></td><td></td><td>http://darcs.haskell.org/git-mirrors/bytestring/.git/</td><td>http://darcs.haskell.org/packages/bytestring.git/</td><td>libraries/bytestring</td></tr>
<tr><td></td><td></td><td style="color: green;">git://github.com/haskell/cabal.git</td><td>http://darcs.haskell.org/git-mirrors/Cabal/.git/</td><td>http://darcs.haskell.org/packages/Cabal.git/</td><td>libraries/Cabal</td></tr>
<tr><td></td><td></td><td style="color: green;">git://github.com/haskell/containers.git</td><td>http://darcs.haskell.org/git-mirrors/containers/.git/</td><td>http://darcs.haskell.org/packages/containers.git/</td><td>libraries/containers</td></tr>
<tr><td></td><td></td><td></td><td></td><td style="color: green;">http://darcs.haskell.org/packages/directory.git/</td><td>libraries/directory</td></tr>
<tr><td></td><td></td><td></td><td></td><td style="color: green;">http://darcs.haskell.org/packages/extensible-exceptions.git/</td><td>libraries/extensible-exceptions</td></tr>
<tr><td></td><td></td><td></td><td></td><td style="color: green;">http://darcs.haskell.org/packages/filepath.git/</td><td>libraries/filepath</td></tr>
<tr><td></td><td></td><td></td><td></td><td style="color: green;">http://darcs.haskell.org/packages/ghc-prim.git/</td><td>libraries/ghc-prim</td></tr>
<tr><td style="color: green;">http://code.haskell.org/haskeline/</td><td>http://darcs.haskell.org/darcs-mirrors/haskeline/</td><td></td><td>http://darcs.haskell.org/git-mirrors/haskeline/.git/</td><td>http://darcs.haskell.org/packages/haskeline.git/</td><td>libraries/haskeline</td></tr>
<tr><td></td><td></td><td></td><td></td><td style="color: green;">http://darcs.haskell.org/packages/haskell98.git/</td><td>libraries/haskell98</td></tr>
<tr><td></td><td></td><td></td><td></td><td style="color: green;">http://darcs.haskell.org/packages/haskell2010.git/</td><td>libraries/haskell2010</td></tr>
<tr><td></td><td></td><td></td><td></td><td style="color: green;">http://darcs.haskell.org/packages/hoopl.git/</td><td>libraries/hoopl</td></tr>
<tr><td></td><td></td><td></td><td></td><td style="color: green;">http://darcs.haskell.org/packages/hpc.git/</td><td>libraries/hpc</td></tr>
<tr><td></td><td></td><td></td><td></td><td style="color: green;">http://darcs.haskell.org/packages/integer-gmp.git/</td><td>libraries/integer-gmp</td></tr>
<tr><td></td><td></td><td></td><td></td><td style="color: green;">http://darcs.haskell.org/packages/integer-simple.git/</td><td>libraries/integer-simple</td></tr>
<tr><td></td><td></td><td style="color: green;">git://github.com/ekmett/mtl.git</td><td>http://darcs.haskell.org/git-mirrors/mtl/.git</td><td>http://darcs.haskell.org/packages/mtl.git/</td><td>libraries/mtl</td></tr>
<tr><td></td><td></td><td></td><td></td><td style="color: green;">http://darcs.haskell.org/packages/old-locale.git/</td><td>libraries/old-locale</td></tr>
<tr><td></td><td></td><td></td><td></td><td style="color: green;">http://darcs.haskell.org/packages/old-time.git/</td><td>libraries/old-time</td></tr>
<tr><td></td><td></td><td style="color: green;">git://github.com/haskell/pretty.git</td><td>http://darcs.haskell.org/git-mirrors/pretty/</td><td>http://darcs.haskell.org/packages/pretty.git/</td><td>libraries/pretty</td></tr>
<tr><td></td><td></td><td></td><td></td><td style="color: green;">http://darcs.haskell.org/packages/process.git/</td><td>libraries/process</td></tr>
<tr><td></td><td></td><td style="color: green;">git://github.com/haskell/random.git</td><td>http://darcs.haskell.org/git-mirrors/random/</td><td>http://darcs.haskell.org/packages/random.git/</td><td>libraries/random</td></tr>
<tr><td></td><td></td><td></td><td></td><td style="color: green;">http://darcs.haskell.org/packages/template-haskell.git/</td><td>libraries/template-haskell</td></tr>
<tr><td style="color: green;">http://code.haskell.org/terminfo/</td><td>http://darcs.haskell.org/darcs-mirrors/terminfo/</td><td></td><td>http://darcs.haskell.org/git-mirrors/terminfo/.git/</td><td>http://darcs.haskell.org/packages/terminfo.git/</td><td>libraries/terminfo</td></tr>
<tr><td style="color: green;">http://code.haskell.org/~ross/transformers</td><td>http://darcs.haskell.org/darcs-mirrors/transformers/</td><td></td><td>http://darcs.haskell.org/git-mirrors/transformers/.git/</td><td>http://darcs.haskell.org/packages/transformers.git/</td><td>libraries/transformers</td></tr>
<tr><td></td><td></td><td></td><td></td><td style="color: green;">http://darcs.haskell.org/packages/unix.git/</td><td>libraries/unix</td></tr>
<tr><td></td><td></td><td style="color: green;">https://github.com/glguy/utf8-string.git</td><td>http://darcs.haskell.org/git-mirrors/utf8-string/</td><td>http://darcs.haskell.org/packages/utf8-string.git/</td><td>libraries/utf8-string</td></tr>
<tr><td></td><td></td><td style="color: green;">git://github.com/haskell/win32.git</td><td>http://darcs.haskell.org/git-mirrors/Win32/</td><td>http://darcs.haskell.org/packages/Win32.git/</td><td>libraries/Win32</td></tr>
<tr><td></td><td></td><td style="color: green;">git://github.com/haskell/xhtml.git</td><td>http://darcs.haskell.org/git-mirrors/xhtml/</td><td>http://darcs.haskell.org/packages/xhtml.git/</td><td>libraries/xhtml</td></tr>
<tr><td></td><td></td><td></td><td></td><td style="color: green;">http://darcs.haskell.org/testsuite.git/</td><td>testsuite</td><td>testsuite</td></tr>
<tr><td></td><td></td><td></td><td></td><td style="color: green;">http://darcs.haskell.org/nofib.git</td><td>nofib</td><td>nofib</td></tr>
<tr><td style="color: green;">http://code.haskell.org/primitive/</td><td>http://darcs.haskell.org/darcs-mirrors/primitive/</td><td></td><td>http://darcs.haskell.org/git-mirrors/primitive/.git/</td><td>http://darcs.haskell.org/packages/primitive.git/</td><td>libraries/primitive</td><td rowspan="3">dph</td></tr>
<tr><td style="color: green;">http://code.haskell.org/vector/</td><td>http://darcs.haskell.org/darcs-mirrors/vector/</td><td></td><td>http://darcs.haskell.org/git-mirrors/vector/.git/</td><td>http://darcs.haskell.org/packages/vector.git/</td><td>libraries/vector</td></tr>
<tr><td></td><td></td><td></td><td></td><td style="color: green;">http://darcs.haskell.org/packages/dph.git/</td><td>libraries/dph</td></tr>
<tr><td></td><td></td><td></td><td></td><td style="color: green;">http://darcs.haskell.org/packages/deepseq.git/</td><td>libraries/deepseq</td><td rowspan="3">extra</td></tr>
<tr><td></td><td></td><td></td><td></td><td style="color: green;">http://darcs.haskell.org/packages/parallel.git/</td><td>libraries/parallel</td></tr>
<tr><td></td><td></td><td></td><td></td><td style="color: green;">http://darcs.haskell.org/packages/stm.git/</td><td>libraries/stm</td></tr>
</table>
}}}

== Mirroring new packages to !GitHub ==

Currently, all our repositories are being mirrored to !GitHub by !GitHub themselves. If you wish to add/remove a repository you need to email !GitHub support at support@github.com and ask them to do it. Currently there is no way to administer this ourselves.

== Branches ==

The following branches are active:

 '''7.4 Branch'''::
 To switch to this branch run:
 {{{ 
 $ ./sync-all checkout ghc-7.4
 }}}
